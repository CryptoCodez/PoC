// Author: Marc Puttkammer	
// Compile: gcc -zexecstack
// Angreifbare gets() Funktion
// 

#include <stdio.h>	// Standard Ein und Ausgabe Funktionen
#include <stdlib.h>     // Exit und Standard Funktionen
#include <string.h>	// strdup [reserviert neuen Speicher und kopiert eine Zeichenkette vom Typ String hinein]

int vulnFunc() { // Die unsichere Funktion		
// ? bytes neuer Daten der Funktion
// 4/8 bytes Frame Pointer 
// 4/8 bytes Ruecksprungaddresse
//
  char getsBuffer[125]; 	    // Buffer
  gets(getsBuffer);                 // Texteingabe in das Buffer
  return strdup(getsBuffer);        // Texteingabe wird zurueck gegeben
}

int main() {  // Hier startet das Programm
  vulnFunc(); // Ruft die unsichere Funktion auf
  exit(0);    // Beendet das Programm
}

void neverCall() { 	// Wird niemals aufgerufen!
  printf("Hacked"); 	// Zur ueberpruefung ob alles geklappt hat
  exit(0); 		// Zum garantierten beenden
}
